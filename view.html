<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tekst - P. A. Barczewska</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">
<style>
body{ margin:0; font-family:"Inter",sans-serif; background:#151515; color:#fff; line-height:1.8; background-image:url("../file_000000006408722fa2ddd16807e0f8b7.png"); background-size:cover; background-attachment:fixed; }
article{ max-width:800px; margin:40px auto; background:rgba(255,255,255,0.85); color:#151515; padding:40px; border-radius:30px; backdrop-filter:blur(10px); }
h1{ font-family:"Playfair Display",serif; font-size:2.2rem; }
.back{ display:inline-block; margin-bottom:20px; text-decoration:none; color:#444; font-weight:600; }
</style>
</head>
<body>
<article>
  <a href="index.html" class="back">← Wróć do strony głównej</a>
  <div id="post-content">Ładowanie treści...</div>
</article>

<script>
const SPACE_ID = "4njr98q3c6g4", TOKEN = "GjcqWIsIud_ukRdgbQPJrzwsRbwkBxO4g5K6-SMwE2Y";
const params = new URLSearchParams(window.location.search), ID = params.get("id");

function renderRT(node) {
  if(!node) return "";
  if(node.nodeType === "text") return node.value;
  if(node.nodeType === "paragraph") return "<p>" + (node.content.map(renderRT).join("")) + "</p>";
  if(node.content) return node.content.map(renderRT).join("");
  return "";
}

async function load() {
  if(!ID) { document.getElementById("post-content").textContent = "Błąd: Brak tekstu."; return; }
  try {
    const res = await fetch("https://cdn.contentful.com/spaces/"+SPACE_ID+"/environments/master/entries/"+ID+"?access_token="+TOKEN+"&locale=*");
    const data = await res.json();
    const loc = Object.keys(data.fields.title)[0];
    document.getElementById("post-content").innerHTML = "<h1>"+data.fields.title[loc]+"</h1>" + renderRT(data.fields.content[loc]);
  } catch(e) { document.getElementById("post-content").textContent = "Nie udało się pobrać tekstu."; }
}
load();
</script>
    const SPACE = "4njr98q3c6g4";
    const TOKEN = "GjcqWIsIud_ukRdgbQPJrzwsRbwkBxO4g5K6-SMwE2Y";

    // Ekspercki parser: zamienia obiekt JSON z Contentful na czysty HTML
    function renderNode(node) {
        if (!node) return "";
        if (node.nodeType === "text") return node.value;
        
        const content = node.content ? node.content.map(renderNode).join("") : "";
        
        switch (node.nodeType) {
            case "paragraph": return `<p>${content}</p>`;
            case "heading-1": return `<h1>${content}</h1>`;
            case "heading-2": return `<h2>${content}</h2>`;
            case "unordered-list": return `<ul>${content}</ul>`;
            case "list-item": return `<li>${content}</li>`;
            default: return content;
        }
    }

    async function loadPost() {
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');
        const contentBox = document.getElementById("post-content"); // MUSISZ mieć div o tym ID w HTML

        if (!postId) {
            contentBox.innerHTML = "<p>Nie znaleziono artykułu.</p>";
            return;
        }

        try {
            const response = await fetch(`https://cdn.contentful.com/spaces/${SPACE}/environments/master/entries/${postId}?access_token=${TOKEN}&locale=*`);
            const entry = await response.json();
            const f = entry.fields;
            const lang = f.title['pl'] ? 'pl' : Object.keys(f.title)[0];

            // Wstawianie tytułu i treści
            document.title = f.title[lang];
            document.querySelector("h1").textContent = f.title[lang];
            
            // Renderowanie treści artykułu
            contentBox.innerHTML = f.content[lang].content.map(renderNode).join("");

        } catch (error) {
            contentBox.innerHTML = "<p>Błąd pobierania treści artykułu.</p>";
        }
    }

    loadPost();
</script>

</body>
</html>
